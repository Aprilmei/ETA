<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real Time Information</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js" type="text/javascript"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
    <link href="{{ url_for('static', filename='css/index.css') }}" rel="stylesheet" type="text/css">



</head>
<body>

    <!-- Main div containing the whole page -->
    <div class="container">
        <!-- Jumbotron containg site title and tagline -->
        <div class="jumbotron">
            <h1 class="page-header">ETA</h1>
            <br>
            <p>Your source of real-time information</p>
        </div>
        <div>
            <!-- Navigation Bar - Collapsible for Mobile Optimisation -->
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                        <a class="navbar-brand" href="#">ETA</a>
                    </div>
                    <div class="collapse navbar-collapse" id="myNavbar">
                        <ul class="nav navbar-nav">
                            <li><a href="#">Home</a></li>
                            <li><a href="#">Route Planner</a>
                                <li><a href="#">Timetables</a></li>
                                <li class="active"><a href="#">Real Time Information</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="#"><span class="glyphicon glyphicon-log-in"></span>Login</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    <div id="select_div">
        <label for="origin">Origin:</label>
                        <select class="form-control" id="origin">
                            <option disabled="disabled" selected="selected">
				            Select your stop
			                </option>
                        </select>
    </div>
        <div id="results">
        </div>
    </div>

<script>
    function get_rti(stop_id) {
        $.getJSON("https://data.dublinked.ie/cgi-bin/rtpi/realtimebusinformation?stopid=" + stop_id + "&format=json", function (data) {
            console.log(data);
            var results = data.results;
            var out = data.errormessage + "<br><table style='width:50%'><th>Route</th><th>Destination</th><th>Time</th>";
            for(var i = 0; i < results.length; i++){
                out += "<tr><td>" + results[i]["route"] + "</td>";
                out += "<td>" + results[i]["destination"] + "</td>";
                out += "<td>" + results[i]["duetime"] + "</td></tr>";
            }
            out += "</table>";
            document.getElementById("results").innerHTML = out;
        }

            )
    }

    function pop_origin_stops() {
    var origin_drop = $('#origin');
    $.getJSON("http://127.0.0.1:5000/stops/2017", function (data) {
        if ('stops' in data) {
            var stops = data.stops;
            console.log('stops', stops);
            _.forEach(stops, function (data) {
                origin_drop.append($('<option>', {
                    value: data.stop_id,
                    text: data.stop_address + " - Stop No: " + data.stop_id
                }, '</option>'));
            })
        }
    })
}

    $("#origin").change(function () {
    get_rti($("#origin").val());
    });

    window.onload = function(){
        pop_origin_stops();
    }

</script>


</body>
</html>